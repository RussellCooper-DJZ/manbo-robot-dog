# 硬件设计文档

## 1. 系统架构

曼波机器狗的硬件系统采用模块化设计,主要包括以下几个部分:

- **控制核心**: STM32F103C8T6微控制器
- **执行机构**: 8个SG90舵机
- **感知系统**: 超声波传感器 + 红外传感器
- **通信系统**: 蓝牙模块 + 语音识别 + 语音合成
- **显示系统**: OLED屏幕 + LED指示灯
- **电源系统**: 锂电池 + 稳压模块

## 2. 主控制器

### 2.1 STM32F103C8T6

**主要参数**:
- 内核: ARM Cortex-M3
- 主频: 72MHz
- Flash: 64KB
- SRAM: 20KB
- GPIO: 37个
- 定时器: 3个通用定时器 + 1个高级定时器
- 串口: 3个USART
- I2C: 2个
- SPI: 2个
- ADC: 2个12位ADC

**选型理由**:
1. 性能充足,能够胜任多任务处理
2. 外设丰富,满足8路PWM和3路串口需求
3. 开发生态成熟,资料丰富
4. 性价比高

### 2.2 最小系统

**电源电路**:
- 输入: 7.4V (锂电池)
- 输出: 3.3V (LDO稳压)
- 去耦电容: 100nF + 10uF

**时钟电路**:
- HSE: 8MHz无源晶振
- LSE: 32.768KHz晶振
- PLL倍频: 72MHz系统时钟

**复位电路**:
- 按键复位 + RC复位

## 3. 执行机构

### 3.1 SG90舵机

**技术参数**:
- 工作电压: 4.8V - 6V
- 扭矩: 1.8kg·cm (4.8V)
- 速度: 0.12s/60° (4.8V)
- 转角范围: 0° - 180°
- 重量: 9g
- 尺寸: 22.2 × 11.8 × 31mm

**控制方式**:
- PWM周期: 20ms (50Hz)
- 脉宽范围: 0.5ms - 2.5ms
- 角度对应:
  - 0.5ms → 0°
  - 1.5ms → 90°
  - 2.5ms → 180°

### 3.2 舵机布局

**四条腿配置**:
- 左前腿: 舵机1(髋) + 舵机2(膝)
- 右前腿: 舵机3(髋) + 舵机4(膝)
- 左后腿: 舵机5(髋) + 舵机6(膝)
- 右后腿: 舵机7(髋) + 舵机8(膝)

**PWM引脚分配**:
| 舵机 | STM32引脚 | 定时器通道 |
|------|-----------|------------|
| 舵机1 | PA0 | TIM2_CH1 |
| 舵机2 | PA1 | TIM2_CH2 |
| 舵机3 | PA2 | TIM2_CH3 |
| 舵机4 | PA3 | TIM2_CH4 |
| 舵机5 | PA6 | TIM3_CH1 |
| 舵机6 | PA7 | TIM3_CH2 |
| 舵机7 | PB0 | TIM3_CH3 |
| 舵机8 | PB1 | TIM3_CH4 |

## 4. 传感器系统

### 4.1 HC-SR04超声波传感器

**技术参数**:
- 工作电压: 5V
- 工作电流: 15mA
- 测量范围: 2cm - 400cm
- 测量精度: ±3mm
- 测量角度: 15°
- 触发信号: 10μs高电平

**工作原理**:
1. 向Trig引脚发送10μs高电平触发
2. 模块自动发送8个40kHz超声波
3. Echo引脚输出高电平,持续时间为往返时间
4. 距离 = (高电平时间 × 340m/s) / 2

**引脚连接**:
- Trig → PB12
- Echo → PB13
- VCC → 5V
- GND → GND

### 4.2 红外避障传感器

**技术参数**:
- 工作电压: 3.3V - 5V
- 检测距离: 2cm - 30cm (可调)
- 输出: 数字信号 (有障碍物→低电平, 无障碍物→高电平)

**布局方案**:
- 前方: PB2
- 后方: PB3
- 左侧: PB4
- 右侧: PB5

**应用场景**:
- 桌面边缘检测
- 防跌落保护
- 近距离障碍物检测

## 5. 通信系统

### 5.1 HC-05/HC-06蓝牙模块

**技术参数**:
- 工作电压: 3.3V - 5V
- 通信距离: 10m (开阔环境)
- 波特率: 9600bps (默认)
- 接口: UART

**引脚连接**:
- TX → PA10 (USART1_RX)
- RX → PA9 (USART1_TX)
- VCC → 5V
- GND → GND

**通信协议**:
- 单字符指令
- 无校验位
- 1位停止位

### 5.2 SU-03T语音识别模块

**技术参数**:
- 工作电压: 3.3V - 5V
- 识别方式: 离线识别
- 识别词条: 可自定义
- 接口: UART

**引脚连接**:
- TX → PB11 (USART3_RX)
- RX → PB10 (USART3_TX)
- VCC → 5V
- GND → GND

**预设指令词**:
- 前进、后退、左转、右转
- 停止、站立、坐下、睡觉
- 旺旺

### 5.3 SYN6288语音合成模块

**技术参数**:
- 工作电压: 3.3V - 5V
- 合成语言: 中文、英文、数字
- 音质: 16KHz采样率
- 接口: UART

**引脚连接**:
- TX → PA3 (USART2_RX)
- RX → PA2 (USART2_TX)
- SPK+ / SPK- → 扬声器
- VCC → 5V
- GND → GND

**数据帧格式**:
```
[帧头][长度][命令][参数][数据][校验和]
0xFD  2字节  1字节  N字节  文本  1字节
```

## 6. 显示系统

### 6.1 OLED显示屏

**技术参数**:
- 尺寸: 0.96英寸
- 分辨率: 128×64
- 颜色: 单色 (蓝色/白色)
- 接口: I2C
- I2C地址: 0x78 (或0x3C)

**引脚连接**:
- SCL → PB6 (I2C1_SCL)
- SDA → PB7 (I2C1_SDA)
- VCC → 3.3V
- GND → GND

**显示内容**:
- 眼部表情 (立正、睡觉、难受等)
- 状态信息 (体力值、开心值)

### 6.2 LED指示灯

**引脚连接**:
- LED → PC13
- 类型: 板载LED

**指示功能**:
- 闪烁: 系统正常运行
- 常亮: 特定模式
- 熄灭: 待机状态

## 7. 电源系统

### 7.1 电池

**配置**:
- 类型: 18650锂电池
- 数量: 2节串联
- 电压: 7.4V (标称)
- 容量: 2600mAh × 2

**续航估算**:
- 待机电流: ~100mA
- 运动电流: ~500-2000mA
- 续航时间: 60-90分钟 (中等强度)

### 7.2 稳压模块

**5V稳压 (舵机供电)**:
- 输入: 7.4V
- 输出: 5V / 3A
- 方案: LM2596 DC-DC降压模块

**3.3V稳压 (主控及逻辑电路)**:
- 输入: 5V
- 输出: 3.3V / 800mA
- 方案: AMS1117-3.3 LDO稳压器

**电源分路**:
- 5V路: 舵机 (大电流)
- 3.3V路: STM32、传感器、通信模块 (小电流)

**保护措施**:
- 输入端: 防反接二极管
- 输出端: 滤波电容 (100uF + 10uF)
- 过流保护: 自恢复保险丝

## 8. PCB设计建议

### 8.1 布局原则

1. **模块化布局**: 将功能模块分区放置
2. **电源隔离**: 大电流路径与信号线分离
3. **短连接**: 高速信号线尽量短
4. **去耦电容**: 每个IC附近放置去耦电容

### 8.2 走线规则

1. **电源线**: 尽量粗 (≥1mm)
2. **信号线**: 0.3-0.5mm
3. **差分线**: 等长等宽
4. **地线**: 大面积铺铜

### 8.3 接口设计

**扩展接口**:
- 预留GPIO接口 (用于功能扩展)
- 预留I2C接口 (用于传感器扩展)
- 预留SPI接口 (用于存储扩展)

**调试接口**:
- SWD接口 (SWDIO, SWCLK)
- 串口调试接口 (USART1)

## 9. 机械结构

### 9.1 3D打印件

**材料**: PLA / ABS
**厚度**: 2-3mm
**打印方向**: 建议竖着打印 (提高强度)

**主要部件**:
- 身体框架
- 腿部连杆
- 舵机固定座
- 传感器支架

### 9.2 装配要点

1. **舵机安装**: 使用M2螺丝固定
2. **连杆连接**: 使用舵机摇臂和螺丝
3. **传感器固定**: 使用热熔胶或双面胶
4. **电池固定**: 使用魔术贴

### 9.3 调试校准

1. **舵机中位校准**: 所有舵机先设置为90°
2. **腿部对称性**: 确保四条腿长度一致
3. **重心调整**: 电池位置影响稳定性
4. **传感器角度**: 超声波水平,红外向下

## 10. 物料清单 (BOM)

| 序号 | 名称 | 型号/规格 | 数量 | 单价 | 备注 |
|------|------|-----------|------|------|------|
| 1 | 主控芯片 | STM32F103C8T6 | 1 | ¥10 | 核心控制器 |
| 2 | 舵机 | SG90 | 8 | ¥5 | 执行机构 |
| 3 | 超声波传感器 | HC-SR04 | 1 | ¥3 | 测距 |
| 4 | 红外传感器 | 红外避障模块 | 4 | ¥2 | 边缘检测 |
| 5 | 蓝牙模块 | HC-05/HC-06 | 1 | ¥15 | 无线通信 |
| 6 | 语音识别 | SU-03T | 1 | ¥30 | 语音控制 |
| 7 | 语音合成 | SYN6288 | 1 | ¥25 | 语音反馈 |
| 8 | OLED屏幕 | 0.96寸 128×64 | 1 | ¥8 | 显示 |
| 9 | 锂电池 | 18650 2600mAh | 2 | ¥15 | 供电 |
| 10 | 降压模块 | LM2596 | 1 | ¥3 | 5V稳压 |
| 11 | 稳压芯片 | AMS1117-3.3 | 1 | ¥1 | 3.3V稳压 |
| 12 | 晶振 | 8MHz | 1 | ¥0.5 | 系统时钟 |
| 13 | 晶振 | 32.768KHz | 1 | ¥0.5 | RTC时钟 |
| 14 | 电容 | 100nF/10uF等 | 若干 | - | 去耦滤波 |
| 15 | 电阻 | 10KΩ/1KΩ等 | 若干 | - | 上下拉 |
| 16 | 3D打印件 | PLA材料 | 1套 | ¥20 | 机械结构 |
| 17 | 连接线 | 杜邦线 | 若干 | - | 连接 |
| 18 | PCB板 | 定制 | 1 | ¥30 | 电路板 |

**总成本**: 约¥200-250

## 11. 测试与调试

### 11.1 硬件测试

**电源测试**:
1. 测量各路电压是否正常
2. 测量空载和负载电流
3. 检查纹波和稳定性

**舵机测试**:
1. 单个舵机转动测试
2. 多个舵机同时转动测试
3. 堵转保护测试

**传感器测试**:
1. 超声波测距精度测试
2. 红外边缘检测灵敏度测试
3. 抗干扰能力测试

**通信测试**:
1. 蓝牙连接稳定性测试
2. 语音识别准确率测试
3. 语音合成清晰度测试

### 11.2 常见问题

**问题1**: 舵机抖动
- 原因: 电源不足或PWM信号不稳定
- 解决: 增大电源容量,检查PWM配置

**问题2**: 蓝牙无法连接
- 原因: 波特率不匹配或TX/RX接反
- 解决: 检查波特率设置,确认引脚连接

**问题3**: OLED不显示
- 原因: I2C地址错误或供电不足
- 解决: 修改I2C地址,检查电源

**问题4**: 超声波测距不准
- 原因: 环境干扰或安装角度不对
- 解决: 远离干扰源,调整安装角度

## 12. 改进建议

### 12.1 性能提升

1. **升级主控**: 使用STM32F4系列,提升运算能力
2. **更换舵机**: 使用数字舵机,提高精度和响应速度
3. **增加IMU**: 集成MPU6050,实现姿态反馈控制

### 12.2 功能扩展

1. **视觉系统**: 增加摄像头,实现图像识别
2. **触摸传感器**: 增加触摸交互功能
3. **无线充电**: 实现自动回充功能
4. **机械臂**: 增加抓取功能

### 12.3 结构优化

1. **轻量化**: 优化3D模型,减轻重量
2. **模块化**: 设计可拆卸模块,便于维护
3. **防水设计**: 增加防水结构,提高可靠性

---

**文档版本**: v1.0  
**更新日期**: 2025-10-24  
**作者**: Manbo Robot Dog Team

